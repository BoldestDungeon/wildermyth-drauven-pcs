{
"id": "drauven_pc_lightningRod",
"info": {
	"dataVersion": 1,
	"sourceFile": "drauven/drauven_pc_lightningRod",
	"modId": "wildermyth-drauven-pcs",
	"author": "psionusoid",
	"tags": [ "interfusionRecipe" ]
},
"type": "ABILITY",
"verb": "ATTACK",
"ability": {
	"icon": "lightning",
	"category": "attackAbility",
	"strictlyBetterThan": [ "mysticRecipeShackle" ],
	"priority": "1",
	"extraUI": { "overrideRangeShown": "4.6+self.BONUS_RANGE" },
	"usesElementFromEquippedWeapon": true
},
"targets": [
	{
		"template": "SELF",
		"cost": { "class": "ActionPoints", "actionPoints": "attack" },
		"missionFeedback": { "orientTo": "source" }
	},
	{
		"role": "source",
		"template": "ANY",
		"type": "SCENERY",
		"missionFeedback": {
			"suggestionScript": "figures.abilitySelectOption",
			"hoverScript": "figures.abilitySelectHover",
			"selectedScript": "figures.abilitySelectSelected",
			"rangeFeedback": "FRIENDLY_EFFECT_RANGE",
			"suggestionFeedback": "FRIENDLY_EFFECT_SUGGESTION",
			"hoverFeedback": "FRIENDLY_EFFECT_HOVER"
		},
		"relationship": "interfusedWithEntity",
		"aspects": [ "metal" ]
	},
	{
		"template": "ADJACENT_ENEMY",
		"STUB": "Targetable Enemies",
		"showAnyway": true,
		"alwaysSelect": true,
		"missionFeedback": { "rangeFeedback": "ATTACK_RANGE" },
		"aspects": [ "HOSTILE_TARGET", "alive" ],
		"relativeTo": "source",
		"range": "4.6+self.BONUS_RANGE",
		"lineOfSight": "ANY_SCENERY"
	}
],
"outcomes": [
	{
		"class": "MatchTarget",
		"abilityTarget": {
			"role": "subject",
			"template": "ADJACENT_UNIT",
			"choose": "ONE_RANDOM_TRUE",
			"showAnyway": true,
			"missionFeedback": { "rangeFeedback": "ATTACK_RANGE" },
			"relativeTo": "target",
			"notAlreadyMatchedAs": [ "target" ],
			"range": "3",
			"lineOfSight": "TERRAIN_ONLY",
			"test": "GREATER_THAN_OR_EQUAL_TO",
			"a": "ENEMY.self",
			"b": "1"
		}
	},
	{
		"class": "IfRolesArePresent",
		"STUB": "Third target (winterfur staff)",
		"rolesArePresent": [ "subject" ],
		"then": {
			"class": "DoAll",
			"outcomes": [
				{
					"class": "MatchTarget",
					"abilityTarget": {
						"role": "volunteer3",
						"template": "ADJACENT_UNIT",
						"STUB": "A third target, matched if discus is set to hit another enemy (via the winterfur staff)",
						"choose": "ONE_RANDOM_TRUE",
						"showAnyway": true,
						"missionFeedback": { "rangeFeedback": "ATTACK_RANGE" },
						"relativeTo": "subject",
						"notAlreadyMatchedAs": [ "target", "subject" ],
						"range": "3",
						"lineOfSight": "TERRAIN_ONLY",
						"test": "GREATER_THAN_OR_EQUAL_TO",
						"a": "ENEMY.self*self.discusThirdTarget",
						"b": "1"
					}
				}
			]
		}
	},
	{
		"class": "AttackRoll",
		"intermediateRole": "source",
		"attackAnimationType": "magic",
		"showAbilityName": "ifEnemy",
		"stopBlockingTime": "onHit",
		"minimumBlockTimeOnMiss": "2000",
		"particles": [
			{
				"script": "RockGroundExplosion",
				"setPosition": "source",
				"setPosition2": "target"
			},
			{
				"script": "RockGroundExplosion2",
				"setPosition": "source",
				"setPosition2": "target"
			},
			{
				"script": "discusProjectile",
				"setPosition": "source",
				"setPosition2": "target"
			},
			{
				"script": "projectileTrail",
				"setPosition": "source",
				"setPosition2": "target"
			}
		],
		"audioOverride": { "attackHitCue": "Characters/Weapons/Default/weaponHit" },
		"flankMarkOrigin": "source",
		"defenseRollTags": [ "range" ],
		"attackStrength": "self.RANGE_ACCURACY",
		"always": {
			"class": "DoAll",
			"outcomes": [
				{
					"class": "Damage",
					"target": "source",
					"amount": "3",
					"type": "TRUE",
					"showInTooltip": false
				}
			]
		},
		"onHit": {
			"class": "DoAll",
			"outcomes": [
				{
					"class": "IfRolesArePresent",
					"rolesArePresent": [ "subject" ],
					"then": {
						"class": "AttackRoll",
						"STUB": "A bit of weird stuff with minimumBlockTime, to make sure both the 2 and 3 bounce versions look good and don't cut off too early",
						"target": "self",
						"defender": "subject",
						"intermediateRole": "target",
						"attackAnimationType": "magic",
						"stopBlockingTime": "onHit",
						"minimumBlockTime": "(1-COUNT.volunteer3)*2000",
						"minimumBlockTimeOnMiss": "2000",
						"particles": [
							{
								"script": "discusProjectile",
								"setPosition": "target",
								"setPosition2": "subject"
							},
							{
								"script": "projectileTrail",
								"setPosition": "target",
								"setPosition2": "subject"
							}
						],
						"audioOverride": { "attackHitCue": "Characters/Weapons/Default/weaponHit" },
						"attackerAnimationOverride": "",
						"flankMarkOrigin": "target",
						"defenseRollTags": [ "range" ],
						"attackStrength": "self.RANGE_ACCURACY",
						"onHit": {
							"class": "DoAll",
							"outcomes": [
								{
									"class": "IfRolesArePresent",
									"rolesArePresent": [ "volunteer3" ],
									"then": {
										"class": "AttackRoll",
										"target": "self",
										"defender": "volunteer3",
										"intermediateRole": "subject",
										"attackAnimationType": "magic",
										"particles": [
											{
												"script": "discusProjectile",
												"setPosition": "subject",
												"setPosition2": "volunteer3"
											},
											{
												"script": "projectileTrail",
												"setPosition": "subject",
												"setPosition2": "volunteer3"
											}
										],
										"audioOverride": { "attackHitCue": "Characters/Weapons/Default/weaponHit" },
										"attackerAnimationOverride": "",
										"flankMarkOrigin": "subject",
										"defenseRollTags": [ "range" ],
										"attackStrength": "self.RANGE_ACCURACY",
										"onHit": {
											"class": "DoAll",
											"outcomes": [
												{
													"class": "Damage",
													"amount": "ceil((((2+self.POTENCY)+self.SPELL_DAMAGE)/2))",
													"useEquippedWeaponForStunt": true,
													"numDefenders": "3"
												}
											]
										}
									}
								},
								{
									"class": "Damage",
									"amount": "ceil((((2+self.POTENCY)+self.SPELL_DAMAGE)/2))",
									"useEquippedWeaponForStunt": true,
									"numDefenders": "2+COUNT.volunteer3"
								}
							]
						}
					},
					"otherwise": {
						"class": "AttackRoll",
						"target": "self",
						"defender": null,
						"attackAnimationType": "none"
					}
				},
				{
					"class": "Damage",
					"amount": "(2+self.POTENCY)+self.SPELL_DAMAGE",
					"useEquippedWeaponForStunt": true,
					"numDefenders": "(1+COUNT.subject)+COUNT.volunteer3"
				}
			]
		}
	}
]
}