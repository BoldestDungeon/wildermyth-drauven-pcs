{
"id": "drauven_pc_blastingsalvo",
"info": {
	"dataVersion": 1,
	"sourceFile": "drauven/drauven_pc_blastingsalvo",
	"modId": "wildermyth-drauven-pcs",
	"author": "psionusoid",
	"tags": [ "interfusionRecipe" ]
},
"type": "ABILITY",
"verb": "ATTACK",
"ability": {
	"icon": "splintersalvo",
	"category": "attackAbility",
	"priority": "1",
	"usesElementFromEquippedWeapon": true
},
"targets": [
	{
		"template": "SELF",
		"cost": { "class": "ActionPoints", "actionPoints": "attack" },
		"missionFeedback": { "orientTo": "source" }
	},
	{
		"role": "child",
		"template": "ANY",
		"STUB": "If we match one piece of wood, we still want to show the ability on the bar",
		"type": "SCENERY",
		"choose": "ALL",
		"relationship": "interfusedWithEntity",
		"aspects": [ "scenery" ],
		"test": "LESS_THAN",
		"a": "HEALTH-INJURY",
		"b": "20"
	},
	{
		"role": "source",
		"template": "ANY",
		"type": "SCENERY",
		"choose": "ALL",
		"chooseAllMinimum": 2,
		"showAnyway": true,
		"relationship": "interfusedWithEntity",
		"aspects": [ "scenery" ],
		"test": "LESS_THAN",
		"a": "HEALTH-INJURY",
		"b": "20"
	},
	{
		"role": "volunteer",
		"template": "ANY",
		"type": "SCENERY",
		"choose": "ANY",
		"missionFeedback": {
			"selectedScript": "figures.abilitySelectSelected",
			"rangeFeedback": "FRIENDLY_EFFECT_RANGE",
			"suggestionFeedback": "FRIENDLY_EFFECT_SUGGESTION",
			"hoverFeedback": "FRIENDLY_EFFECT_HOVER"
		},
		"relationship": "interfusedWithEntity",
		"aspects": [ "wood" ],
		"test": "LESS_THAN",
		"a": "HEALTH-INJURY",
		"b": "20"
	},
	{
		"role": "fire",
		"template": "ADJACENT_FIRE",
		"choose": "ANY",
		"relativeTo": "source",
		"range": "0.4"
	},
	{
		"role": "hook",
		"template": "TILE",
		"choose": "ANY",
		"showAnyway": true,
		"manifold": {
			"from": "source",
			"to": "source",
			"thickness": [ "0", "1", "4", "1", "0" ],
			"excludeSource": true,
			"excludeDestination": true
		},
		"range": null,
		"lineOfSight": "TERRAIN_ONLY",
		"tileFilter": "floor"
	},
	{
		"role": "hook2",
		"template": "TILE",
		"STUB": "Also include the tiles the wooden objects are on",
		"choose": "ANY",
		"showAnyway": true,
		"range": "1000",
		"lineOfSight": "TERRAIN_ONLY",
		"sameTileAs": "source",
		"tileFilter": "floor"
	},
	{
		"template": "TILE",
		"showAnyway": true,
		"alwaysSelect": true,
		"missionFeedback": { "suggestionFeedback": "FRIENDLY_EFFECT_RANGE_BORDER" },
		"fromRoles": [ "hook", "hook2" ],
		"range": null
	},
	{
		"template": "UNIT_AT_TILE",
		"choose": "ANY",
		"missionFeedback": {
			"hoverScript": "figures.attackHovered",
			"hoverFeedback": "ATTACK_HOVER",
			"feedbackSource": "source"
		},
		"relativeTo": "focus",
		"range": "2.1",
		"lineOfSight": "TERRAIN_ONLY"
	},
	{
		"role": "targetTile",
		"template": "TILE",
		"choose": "ALL",
		"missionFeedback": { "suggestionFeedback": "ATTACK_SUGGESTION" },
		"relativeTo": "focus",
		"range": "2.1",
		"lineOfSight": "TERRAIN_ONLY",
		"tileFilter": "floor"
	}
],
"outcomes": [
	{
		"class": "AttackRoll",
		"defender": null,
		"intermediateRole": "source",
		"attackAnimationType": "magic",
		"showAbilityName": "ifEnemy",
		"stopBlockingTime": "onHit",
		"flankMarkOrigin": "source"
	},
	{
		"class": "ForEach",
		"fromRoles": [ "source" ],
		"toRole": "scenery",
		"outcome": {
			"class": "DoAll",
			"outcomes": [
				{
					"class": "MatchTarget",
					"abilityTarget": {
						"role": "target2",
						"template": "UNIT_AT_TILE",
						"choose": "ANY",
						"missionFeedback": {
							"hoverScript": "figures.attackHovered",
							"hoverFeedback": "ATTACK_HOVER",
							"feedbackSource": "source"
						},
						"relativeTo": "focus",
						"range": "2.1",
						"lineOfSight": "TERRAIN_ONLY"
					}
				},
				{
					"class": "AttackRoll",
					"defender": "target2",
					"intermediateRole": "scenery",
					"attackAnimationType": "none",
					"stopBlockingTime": "onHit",
					"particles": [
						{
							"script": "StunningBarrage",
							"setPosition": "target2",
							"setPosition2": "focus"
						},
						{ "script": "smokeBlast", "setPosition": "target2" },
						{ "script": "smokeBlast", "setPosition": "scenery", "setPosition2": "focus" }
					],
					"audioOverride": { "attackInterfusionStartCue": "Characters/Default/Ability_Barrage" },
					"flankMarkOrigin": "scenery",
					"defenseRollTags": [ "range" ],
					"attackStrength": "self.RANGE_ACCURACY+scenery.HEALTH",
					"separateRolls": true,
					"always": {
						"class": "DoAll",
						"target": "scenery",
						"outcomes": [
							{ "class": "Spawn", "modifyTerrain": "makeWalkableAndCreateDebris" },
							{
								"class": "Aspects",
								"removeAspects": [ "scenery" ]
							},
							{ "class": "Delete" },
							{
								"class": "Spawn",
								"target": "targetTile",
								"modifyTerrain": "spreadDebrisAndFire"
							}
						]
					},
					"onHit": {
						"class": "DoAll",
						"outcomes": [
							{
								"class": "Damage",
								"amount": "(((1d3-1)+self.drauvenDeck_mystic_blastingshard_upgrade)+(self.SPELL_DAMAGE*0.66))+(scenery.HEALTH*(0.25+(self.drauvenDeck_mystic_blastingshard_upgrade*0.5)))",
								"shred": "self.POTENCY*(1+self.drauvenDeck_mystic_blastingshard_upgrade)",
								"pierce": "self.POTENCY*self.drauvenDeck_mystic_blastingshard_upgrade",
								"useEquippedWeaponForStunt": true,
								"numDefenders": "COUNT.target"
							}
						]
					}
				}
			]
		}
	}
]
}