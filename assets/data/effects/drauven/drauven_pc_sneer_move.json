{
"id": "drauven_pc_sneer_move|_ATTACKER_",
"info": {
	"dataVersion": 1,
	"sourceFile": "drauven/drauven_pc_sneer_move",
	"modId": "wildermyth-drauven-pcs",
	"author": "psionusoid",
	"aiPriority": "2000",
	"debug": true
},
"type": "ANY_UNIT_ABILITY_USED",
"verb": "MANEUVER",
"targets": [
	{
		"template": "SELF",
		"aspectValues": [
			{ "id": "pinned", "forbidden": true }
		]
	},
	{
		"role": "attacker",
		"template": "ANY",
		"type": "UNIT",
		"matchSpecial": "parameter1"
	},
	{
		"role": "hook3",
		"template": "TILE",
		"STUB": "All footprint tiles",
		"choose": "ALL",
		"relativeTo": "attacker",
		"range": "0"
	},
	{
		"role": "targetTile",
		"template": "TILE",
		"STUB": "Closest within LOS footprint tile (to be sure it's actually in-range and targetable by the branched ability)",
		"choose": "ONE_CLOSEST",
		"fromRoles": [ "hook3" ],
		"range": null,
		"lineOfSight": "TERRAIN_ONLY"
	},
	{
		"role": "volunteer",
		"template": "TILE",
		"choose": "ALL",
		"range": "2.6",
		"lineOfSight": "TERRAIN_ONLY",
		"tileFilter": "validMoveEnd",
		"roleMustFit": "self"
	},
	{
		"role": "monster",
		"template": "ADJACENT_ENEMY",
		"choose": "ANY",
		"aspects": [ "HOSTILE_TARGET", "alive" ],
		"range": "8"
	},
	{
		"role": "volunteer2",
		"template": "ADJACENT_ALLY",
		"choose": "ANY",
		"range": "4"
	},
	{
		"template": "TILE",
		"choose": "BY_SCORE",
		"scoreFunction": "volunteer.distanceTo.attacker",
		"fromRoles": [ "volunteer" ],
		"relativeTo": "attacker",
		"range": null
	}
],
"outcomes": [
	{
		"class": "Aspects",
		"removeAspects": [ "drauven_pc_sneer_move|*" ]
	},
	{
		"class": "AttackRoll",
		"defender": null,
		"attackAnimationType": "interaction",
		"showAbilityName": "always",
		"timingOverride": { "beforeAnimationTime": "0", "afterAnimationTime": "0" },
		"attackerAnimationOverride": "",
		"defenderAnimationOverride": "",
		"markForFlanking": "never",
		"always": {
			"class": "DoAll",
			"outcomes": [
				{
					"class": "MoveEntity",
					"directlyToTile": "focus",
					"ignoreEntitiesOnTile": true,
					"animationType": "leap"
				},
				{
					"class": "Test",
					"value": "self.drauvenDeck_mystic_sneer_upgrade",
					"threshold": "1",
					"onPass": {
						"class": "Test",
						"value": "self.drauvenDeck_mystic_fireshot",
						"threshold": "1",
						"onPass": {
							"class": "BranchAbility",
							"targetRole": "attacker",
							"tileRole": "targetTile",
							"branchAbility": "drauven_pc_fireshot"
						},
						"onFail": {
							"class": "Test",
							"value": "self.RANGE_EQUIPPED*greaterThan(self.distanceTo.targetTile,self.MIN_RANGED_ATTACK_RANGE)",
							"threshold": "1",
							"onPass": {
								"class": "BranchAbility",
								"target": "self",
								"branchType": "standardRanged",
								"targetRole": "attacker",
								"tileRole": "targetTile"
							},
							"onFail": {
								"class": "BranchAbility",
								"target": "self",
								"branchType": "standardMelee",
								"targetRole": "attacker",
								"tileRole": "targetTile"
							}
						}
					}
				}
			]
		}
	}
]
}