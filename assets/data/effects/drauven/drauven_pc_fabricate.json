{
"id": "drauven_pc_fabricate",
"info": {
	"dataVersion": 1,
	"sourceFile": "drauven/drauven_pc_fabricate",
	"modId": "wildermyth-drauven-pcs",
	"author": "psionusoid",
	"tags": [ "sneaky", "drauven_pc_fabricate" ]
},
"type": "ABILITY",
"verb": "ATTACK",
"ability": {
	"icon": "forge",
	"category": "neutralAbility",
	"priority": "3",
	"extraUI": { "overrideRangeShown": "4.6+self.BONUS_RANGE" },
	"overrideOverlayType": "interfuse"
},
"targets": [
	{
		"template": "SELF",
		"cost": { "class": "ActionPoints" },
		"missionFeedback": { "orientTo": "focus" }
	},
	{
		"role": "targetTile",
		"template": "TILE",
		"choose": "ANY",
		"missionFeedback": { "rangeFeedback": "FRIENDLY_EFFECT_RANGE" },
		"range": "4.6+self.BONUS_RANGE",
		"lineOfSight": "LIVE_ENEMIES",
		"tileFilter": "forbidSceneryAllowPits",
		"tileFilterRange": "1"
	},
	{
		"template": "TILE",
		"alwaysSelect": true,
		"missionFeedback": {
			"hoverScript": "figures.directionalTileHoverHelpful",
			"suggestionFeedback": "FRIENDLY_EFFECT_RANGE_BORDER",
			"hoverFeedback": "FRIENDLY_EFFECT_HOVER",
			"feedbackSource": "self"
		},
		"fromRoles": [ "targetTile" ],
		"range": null,
		"tileFilter": "validScenerySpawnLocation"
	},
	{
		"role": "volunteer",
		"template": "SELF",
		"choose": "ANY",
		"fromRoles": [ "self" ],
		"aspectValues": [
			{
				"id": "interfused",
				"maxValue": "(((mystic*2)+numExtraInterfusions)+(mysticDeck_openmind*(1+floor((POTENCY/3)))))-1"
			}
		]
	},
	{
		"template": "UNIT_AT_TILE",
		"choose": "ANY",
		"missionFeedback": {
			"hoverScript": "figures.attackHovered",
			"rangeFeedback": "ATTACK_RANGE",
			"suggestionFeedback": "ATTACK_SUGGESTION",
			"hoverFeedback": "ATTACK_HOVER",
			"canFlank": false
		},
		"aspectValues": [
			{ "id": "ENEMY", "relativeTo": "self" }
		],
		"relativeTo": "focus",
		"range": "1.6+(self.POTENCY/3)"
	}
],
"outcomes": [
	{
		"class": "AttackRoll",
		"intermediateRole": "focus",
		"attackAnimationType": "magic",
		"showAbilityName": "ifEnemy",
		"particles": [
			{ "script": "Vines1", "setPosition": "target" },
			{ "script": "TreeSpawn", "setPosition": "focus" },
			{ "script": "LeafExplosion", "setPosition": "focus" }
		],
		"audioOverride": { "attackStartCue": "" },
		"flankMarkOrigin": "focus",
		"defenseRollTags": [ "range" ],
		"attackStrength": "self.RANGE_ACCURACY",
		"always": {
			"class": "DoAll",
			"outcomes": [
				{
					"class": "Spawn",
					"target": "focus",
					"addRole": "scenery",
					"modifyTerrain": "setToBlocked",
					"createEntity": {
						"query": {
							"type": "SCENERY",
							"tags": [ "fabricate" ],
							"coordinates": "focus"
						},
						"setLocation": true
					}
				},
				{
					"class": "Animate",
					"audioAtPosition": {
						"audioId": "Characters/Default/Ability_Arches",
						"setPosition": "focus",
						"delay": "-500"
					}
				},
				{
					"class": "IfRolesArePresent",
					"rolesArePresent": [ "scenery", "volunteer" ],
					"then": {
						"class": "DoAll",
						"target": "volunteer",
						"outcomes": [
							{
								"class": "Aspects",
								"addAspects": [
									{
										"id": "interfusedWithEntity",
										"value": "1",
										"merge": "max",
										"inRelationTo": "scenery"
									}
								]
							},
							{
								"class": "Aspects",
								"target": "scenery",
								"addAspects": [
									{
										"id": "interfusedWithMystic",
										"value": "1",
										"merge": "max",
										"inRelationTo": "volunteer"
									},
									{ "id": "interfusedWithHuman", "value": "1", "merge": "max" }
								]
							}
						]
					}
				}
			]
		},
		"onHit": {
			"class": "DoAll",
			"outcomes": [
				{
					"class": "Aspects",
					"addAspects": [
						{ "id": "pinned", "value": "1" }
					]
				}
			]
		}
	}
]
}