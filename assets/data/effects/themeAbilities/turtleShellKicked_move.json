{
"id": "turtleShellKicked_move|_ATTACKER_",
"info": {
	"dataVersion": 1,
	"sourceFile": "themeAbilities/turtleShellKicked_move",
	"author": "David Bilsky",
	"aiPriority": "2000",
	"debug": true
},
"type": "ANY_UNIT_ABILITY_USED",
"verb": "MANEUVER",
"targets": [
	{
		"template": "SELF",
		"aspectValues": [
			{ "id": "pinned", "forbidden": true }
		]
	},
	{
		"role": "attacker",
		"template": "ANY",
		"type": "UNIT",
		"matchSpecial": "parameter1"
	},
	{
		"role": "volunteer",
		"template": "TILE",
		"choose": "ANY",
		"relativeTo": "volunteer",
		"range": "self.turtleShellKicked_strength",
		"lineOfSight": "TERRAIN_ONLY"
	},
	{
		"role": "targetTile",
		"template": "TILE",
		"choose": "ONE_FURTHEST",
		"fromRoles": [ "volunteer" ],
		"relativeTo": "attacker",
		"range": "max(1.9,self.turtleShellKicked_strength)",
		"tileFilter": "validMoveEnd",
		"roleMustFit": "self"
	},
	{
		"role": "target",
		"template": "ADJACENT_ENEMY",
		"choose": "ONE_CLOSEST_OPTIONAL",
		"aspects": ["ENEMY"],
		"aspectValues": [{"id": "turtleShellKicked_wasHit", "forbidden": true}],
		"notAlreadyMatchedAs": ["attacker"],
		"range": "(self.turtleShellKicked_strength)",
		"lineOfSight": "TERRAIN_ONLY",
		"tileFilter": "floor"
	},
	{
		"role": "scenery",
		"template": "ADJACENT_SCENERY",
		"choose": "ONE_CLOSEST_OPTIONAL",
		"aspectValues": [{"id": "turtleShellKicked_wasHit", "forbidden": true}],
		"manifold": {
			"from": "self",
			"to": "targetTile",
			"thickness": [ "1.3", "3.6" ],
			"excludeSource": true,
			"distanceInDirection":  "(self.turtleShellKicked_strength)"
		},
		"range": "(self.turtleShellKicked_strength)",
		"lineOfSight": "TERRAIN_ONLY",
		"tileFilter": "floor"
	}
],
"outcomes": [
	{
		"class": "Aspects",
		"removeAspects": [ "turtleShellKicked_move|*" ]
	},
	{
		"class": "Test",
		"target": "self",
		"value": "EXISTS.target",
		"threshold": "1",
		"onPass": {
			"class": "DoAll",
			"outcomes": [
				{
					"class": "Aspects",
					"target": "self",
					"consumeAspects": [{"id": "turtleShellKicked_strength", "value": "self.distanceTo.target + 1"}]
				},
				{
					"class": "MatchTarget",
					"abilityTarget": {
						"role": "target2",
						"template": "TILE",
						"choose": "ONE_RANDOM",
						"relativeTo": "target",
						"range": "0"
					}
				},
				{
					"class": "AttackRoll",
					"stopBlockingTime": "afterHitAnimation",
					"minimumBlockTime": "20",
					"timingOverride": { "swingTime": "0", "beforeAnimationTime": "0", "afterAnimationTime": "0" },
					"attackAnimationType": "interaction",
					"attackerAnimationOverride": "",
					"defenderAnimationOverride": "",
					"always": {
						"class": "MoveEntity",
						"target": "self",
						"directlyToTile": "target2",
						"ignoreEntitiesOnTile": true,
						"animationType": "leap"
					}
				},
				{
					"class": "BranchAbility",
					"branchAbility": "turtleShellKicked_dealDamage",
					"target": "self",
					"targetRole": "target",
					"tileRole": "target2"
				}
			]
		},
		"onFail": {
			"class": "Test",
			"target": "self",
			"value": "EXISTS.scenery",
			"onPass": {
				"class": "DoAll",
				"outcomes": [
					{
						"class": "Aspects",
						"target": "self",
						"consumeAspects": [{"id": "turtleShellKicked_strength", "value": "self.distanceTo.scenery + 1"}]
					},
					{
						"class": "Aspects",
						"target": "scenery",
						"addAspects": [{"id": "turtleShellKicked_wasHit"}]
					},
					{
						"class": "MatchTarget",
						"abilityTarget": {
							"role": "target2",
							"template": "TILE",
							"choose": "ONE_RANDOM",
							"relativeTo": "scenery",
							"range": "0"
						}
					},
					{
						"class": "AttackRoll",
						"stopBlockingTime": "afterHitAnimation",
						"minimumBlockTime": "20",
						"timingOverride": { "swingTime": "0", "beforeAnimationTime": "0", "afterAnimationTime": "0" },
						"attackAnimationType": "interaction",
						"attackerAnimationOverride": "",
						"defenderAnimationOverride": "",
						"always": {
							"class": "MoveEntity",
							"target": "self",
							"directlyToTile": "target2",
							"ignoreEntitiesOnTile": true,
							"animationType": "leap"
						}
					},
					{
						"class": "BranchAbility",
						"branchAbility": "turtleShellKicked_dealDamage",
						"target": "self",
						"targetRole": "scenery",
						"tileRole": "target2"
					}
				]
			},
			"onFail": {
				"class": "AttackRoll",
				"defender": null,
				"attackAnimationType": "interaction",
				"showAbilityName": "always",
				"timingOverride": { "beforeAnimationTime": "0", "afterAnimationTime": "0" },
				"attackerAnimationOverride": "",
				"defenderAnimationOverride": "",
				"markForFlanking": "never",
				"always": {
					"class": "MoveEntity",
					"target": "self",
					"directlyToTile": "targetTile",
					"ignoreEntitiesOnTile": true,
					"animationType": "leap"
				}
			}
		}
	}
]
}